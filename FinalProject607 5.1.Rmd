---
title: "Final Project Data 607"
author: "Evelyn Bartley and Dhanya Nair"
date: "2024-04-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load Libraries
```{r}
library(tidyverse)
library(ggplot2)
```


## Overview:

This project is an exploratory analysis of electric vehicle sales and prices over time.


## Historic Sales 

This Kaggle dataset ("Historic sales of electric vehicles") is from the Global EV Outlook, an annual publication that identifies and discusses recent developments in electric mobility across the globe.

```{r}
#Read historic EV sales csv into R
historic <- read.csv('https://raw.githubusercontent.com/evelynbartley/Final-Project-607/main/IEA-EV-dataEV%20salesCarsHistorical.csv', header = TRUE)
tibble(historic)
```
*Exploration*

I want to look at the number of electric vehicles sold in each country in the dataset.

```{r}
#sum counts by region
region_counts <- historic %>% 
  group_by(region) %>%
  summarize(count = sum(value))

#remove regions I don't want to look at
region_counts2 <- region_counts[-c(9,36), ]
```

```{r}
#plot region counts 
region_counts2 %>%
  ggplot(aes(x = region, y = count)) + 
  geom_col(fill = "green") + coord_flip() + scale_y_continuous(labels = scales::comma) +
  labs(title = "EV Sales by Region", x = "Region", y = "Count")
```

China has sold the greatest number of electric vehicles of any region, almost two times more than Europe and nearly four times as many as the USA. This is probably due to the fact that China's population is much larger compared to any other region. European countries have purchased the second greatest number of electric vehicles. The USA has purchased the third greatest number of electric vehicles. 


```{r}
#get sales counts by year
year_counts <- historic %>% 
  group_by(year) %>%
  summarize(count = sum(value))
tibble(year_counts)
```

```{r}
year_counts %>%
  ggplot(aes(x = year, y = count)) + 
  geom_col(fill = "green") + 
  scale_y_continuous(labels = scales::comma) + labs(title = "Global EV Sales 2011-2022", x = "Year", y = "Cars")
```
Globally, the number of electric vehicles sold has increased every year since 2011.

```{r}
#filter historic data for only US data
USdata <- historic %>%
  filter(historic$region == "USA")

#plot the trend for US EV sales
USdata %>% ggplot(aes(x = year, y = value)) + 
  geom_col(fill = "green") + scale_y_continuous(labels = scales::comma) + 
  labs(title = "US EV Sales 2011-2022", x = "Year", y = "Cars")
```

The US has closely followed the global trend for EV sales. There was a tiny dip in EV sales in 2015 and a larger dip in 2019 and 2020. EV sales about doubled from 2020 to 2021.

Lets look at BEV vs PHEV sales for the US. BEVs are battery electric vehicles and PHEVs are plug-in hybrid electric vehicles. BEVs run on electricity alone, so they don't require gasoline like PHEVs do.

```{r}
historic %>%
  ggplot(aes(x = year, y = value, fill = powertrain)) +
  geom_col(position = "dodge") +
  scale_y_continuous(labels = scales::comma) +
  labs(title = "Global BEV vs PHEV Sales 2011-2022" , x = "Year", y = "Cars")
```
As EV sales have increased over time, the difference in BEV vs PHEV sales has also increased.

```{r}
USdata %>%
  ggplot(aes(x = year, y = value, fill = powertrain)) +
  geom_col(position = "dodge") +
  scale_y_continuous(labels = scales::comma) +
  labs(title = "USA BEV vs PHEV Sales 2011-2022" , x = "Year", y = "Cars")
```
In the US, BEV and PHEV sales were steadily growing since 2011. PHEV sales reached a peak in 2018 and then started declining until 2021 where they doubled in sales. BEV sales reached a plateau from 2018-2020 and then spiked in 2021 and 2022.



## Web Scraping

```{r}
library(rvest)
library(xml2)
```

I am going to web scrape the EV Charging Station Counts by State table from 'https://www.cnet.com/roadshow/news/how-many-ev-charging-stations-are-there-in-the-us/' that contains the number of public charging stations per state.

```{r}
#save link in a variable
link <- "https://www.cnet.com/roadshow/news/how-many-ev-charging-stations-are-there-in-the-us/"
#read html and save it in variable
page <- read_html(link)
#retrieve html elements 
# I used Selector Gadget to help me get the css selector!
html_data <- page %>%
  html_elements(css = "td , .c-shortcodeChart_chart_hasBg")

head(html_table)
```


```{r}
#retrieve text from html element
stations <- html_text(html_table)
#remove first two items because they are column names
stations2 <- stations[-c(1:2)]
#turn html text into a dataframe by first converting it into a matrix
stationsdf <- as.data.frame(matrix(stations2, ncol = 2, byrow = TRUE)) %>%
  select("State" = V1, "Stations" = V2)
#remove commas from numbers and convert to numeric
stationsdf$Stations <- as.numeric(gsub(",","", stationsdf$Stations))
tibble(stationsdf)
```

```{r}
stationsdf %>% ggplot(aes(x = State, y = Stations)) + 
  geom_col(fill = "green") + coord_flip() +
  labs(title = "Public EV Charging Stations by State")
```



## Statistical Analysis

I want to do statistical analysis on the Number of Public Charging Stations per State in March 2023.
```{r}
#Find avg number of public charging stations in a state
mean(stationsdf$Stations)
```
On average, there are about 1,004 public charging stations in a US State.


```{r}
#maximum
max(stationsdf$Stations)
print(stationsdf$State[which.max(stationsdf$Stations)])
#minimum
min(stationsdf$Stations)
print(stationsdf$State[which.min(stationsdf$Stations)])

```
The state with the greatest number of public charging stations is California.
The state with the least number of public charging stations is Alaska.

```{r}
#boxplot of the distribution of charging stations
stationsdf %>% 
  ggplot(aes(x = Stations)) + geom_boxplot() + 
  xlab('Distribution of Public EV Charging Stations in the US')
```

